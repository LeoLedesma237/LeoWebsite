---
title: "Data Analyzing BRIEF and VR Behavioral Data"
author: "Leandro Ledesma"
date: "2024-02-10"
output: html_document
---

### Overall goal

We are interested in determining whether scores obtained for executive functioning domains in the BRIEF Self-Report are relate to two cognitive tasks performed in virtual reality (VR). For our study, we have two nearly one hour long VR Sessions where subjects engage in a Go/No-Go (GnG) and N-back paradigm. The GnG is a commonly used measure of inhibition in EEG research that habituates a behavior by displaying high frequency of Go signals (80%), which then have to be stopped during the presence of a No-Go signal (20%). There are 1,500 trials in each GnG session and  5 different versions of the GnG (block sessions) within each session. The N-back, specifically the 2-back, is a paradigm that measures working memory. Several stimuli are presented one by one and when one item matches an item seen two items back,  that item (target) needs to be hit. Overall there are roughly 600 trials and about 20% of them are target trials. Additionally, there are 4 different versions of the N-back (block sessions) within each session. 

Performance in the VR Tasks was calculated by taking the sum of correct trials for each participant and dividing it by the total number of trials presented. This was done for all Go trials and No-Go trials respectively for each version of the GnG. Additionally, the same calculation applies to the Nback for target and non-target trials and for each version of the N-back. 

Lastly, our data includes performance for multiple testing days. For our research interest, we will only be including data for Day 1 of the VR Sessions in our analysis, which is performance at baseline. 

The BRIEF Self-Report contains questions for several different domains encompassing executive functioning. We were interested in questions that assessed inhibition and working memory. Thus, T-scores were obtained for each subject on both inhibition and working memory scales.

### Universal block code settings

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(comment = NULL)

```

### Load in the data manipulation packages first

```{r loading in the packages, warning = FALSE}
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(readxl)
library(kableExtra)

```

### Load in the data

```{r load in the data, warning = FALSE}
# Set working directory
setwd("C:/Users/lledesma.TIMES/Documents/ONR/GnG_and_Nback_behavioral_data_preprocessing/Processed Data")

# Load in the GnG data
GnG.performance <- read.csv("GnG.trial.type.csv")
GnG.Reaction.Time <- read.csv("GnG.reaction.time.csv")

# Data cleaning- we are only interested in Day 1
GnG.performance <- GnG.performance %>% filter(Day.Type == "Day 1")
GnG.Reaction.Time <- GnG.Reaction.Time %>% filter(Day.Type == "Day 1")

# Load in the Nback data
Nback.performance <- read.csv("Nback.trial.type.csv")
Nback.Reaction.Time <- read.csv("Nback.reaction.time.csv")

# Data cleaning- we are only interested in Day 1
Nback.performance <- Nback.performance %>% filter(Day.Type == "Day 1")
Nback.Reaction.Time <- Nback.Reaction.Time %>% filter(Day.Type == "Day 1")

# Set working directory
setwd("~/ONR/BRIEF")

# Load in the BRIEF data
Inhibtion.T.scores <- read.csv("Inhibition.T.scores.csv")
Working.Memory.T.scores <- read.csv("Working.Memory.T.scores.csv")

```

### Merge the datasets together

We now need to merge the data frames for GnG and Nback performance to the data frame containing the BRIEF scores for inhibition and working memory. 

```{r merge the datasets}
# merge the inhibition datasets
GnG.performance.merged <- GnG.performance %>%
  rename(ID = UserID) %>%
  merge(Inhibtion.T.scores, by = "ID")

# dimensions of our data
dim(GnG.performance.merged)

# Number of unique ID's in our new dataset
length(unique(GnG.performance.merged$ID))

# merge the working memory datasets
Nback.performance.merged <- Nback.performance %>%
  rename(ID = UserID) %>%
  merge(Working.Memory.T.scores, by = "ID")

# dimensions of our data
dim(Nback.performance.merged)

# Number of unique ID's in our new dataset
length(unique(Nback.performance.merged$ID))
```

### Loss of data

The merger resulted in 53 subjects with all the data that we are interested in. Below are ID's that were not able to be merged either because we did not have Day 1 GnG data or did not have their BRIEF T scores.

```{r loss of data checker}
# IDs that have GnG performance
length(unique(GnG.performance$UserID))

# IDs that have BRIEF inhibiton scores 
length(unique(Inhibtion.T.scores$ID))

# IDs that are in common
intersect(GnG.performance$UserID, Inhibtion.T.scores$ID)

# IDs that are in GnG and not in BRIEF
setdiff(GnG.performance$UserID, Inhibtion.T.scores$ID)

# IDs that are in BRIEF and not in GnG
setdiff(Inhibtion.T.scores$ID,GnG.performance$UserID)

```
Reasons for these discrepancies- data for the BRIEF started collection way after 100 subjects completed the VR tasks Additionally, the BRIEF is collected the very first day of testing while the baseline VR tasks are done on the next visit. Does the discrepancy above could show subjects that either dropped the study after their first visit or that have not yet completed their next visit. 


### View the data

Let's use a scatter plot to see if there are any visual patterns of a relationship between BRIEF T-scores and VR mean performance.

```{r view the data}
# plot GnG performance and Inhibition T scores as a scatter plot
# Do this only for the inhibition trial 
GnG.performance.merged %>%
  filter(Trial.Type == "No-Go") %>%
  ggplot(aes(x= T.score, y = trial.mean.correct, color = BlockName)) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw() +
  labs(x = "BRIEF Inhibit T-scores",
       y = "VR Go/No-Go Performance")

# plot Nback performance and Working Memory T scores as a scatter plot
Nback.performance.merged %>%
  filter(Trial.Type == "Target") %>%
  ggplot(aes(x= T.score, y = trial.mean.correct, color = BlockName)) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_bw() +
  labs(x = "BRIEF Working Memory T-scores",
       y = "VR Nback Performance")


```


### Simple regression

To answer our question, we will be using a simple regression to assess 1) the relationship between inhibiton T-scores and No-Go trial performance in the GnG; and 2) to assess the relationship between working memory T-scores and Target trial performance in the Nback.

```{r running the simple regression}
# Run the GnG regression
No.Go.data <- GnG.performance.merged %>%
  filter(Trial.Type == "No-Go")
  
model1 <- lm(trial.mean.correct ~ T.score ,data = No.Go.data)

# Summary of the model
summary(model1)

# Run the Nback regression 
Target.data <- Nback.performance.merged %>%
  filter(Trial.Type == "Target")

# Run the Nback regression
model2 <- lm(trial.mean.correct ~ T.score, data = Target.data)

# Summary of the model
summary(model2)

```
